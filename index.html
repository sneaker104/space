<script>
  const SAVE_KEY = "my_incremental_save_v1";

  function getDefaultSave() {
    return {
      version: 1,
      resource: 0,
      settings: {
        autosave: true,
        mute: false
      }
    };
  }

  function loadGame() {
    const raw = localStorage.getItem(SAVE_KEY);
    if (!raw) {
      return getDefaultSave();
    }
    try {
      const data = JSON.parse(raw);
      // 기본값과 합쳐서 빠진 항목은 기본값으로 채움
      return {
        ...getDefaultSave(),
        ...data,
        settings: {
          ...getDefaultSave().settings,
          ...(data.settings || {})
        }
      };
    } catch (e) {
      console.error("저장 불러오기 실패", e);
      return getDefaultSave();
    }
  }

  function saveGame() {
    try {
      localStorage.setItem(SAVE_KEY, JSON.stringify(save));
    } catch (e) {
      console.error("저장 실패", e);
    }
  }

  // 실제 게임 상태
  let save = loadGame();

  const resourceEl = document.getElementById("resource");
  const gainBtn = document.getElementById("btn-gain");

  function render() {
    resourceEl.textContent = save.resource;
  }

  gainBtn.addEventListener("click", () => {
    save.resource += 1;
    render();
  });

  // 자동 저장 예시 10초마다
  setInterval(() => {
    if (save.settings.autosave) {
      saveGame();
    }
  }, 10000);

  // 페이지 들어오자마자 화면 반영
  render();
</script>
